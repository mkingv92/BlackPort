# =====================================================================
# File: exploit_indicators.py
# Notes:
# - This file is part of the BlackPort project.
# - The comments added here are for readability only (no behavior change).
# - Use only on hosts/networks you own or have explicit permission to test.
# =====================================================================

from packaging import version

EXPLOIT_DB = [
    {
        "product": "vsFTPd",
        "vulnerable_versions": ["2.3.4"],
        "severity": "CRITICAL",
        "description": "vsFTPd 2.3.4 backdoor vulnerability",
        "reference": "CVE-2011-2523"
    },
    {
        "product": "Apache",
        "max_version": "2.2.999",
        "severity": "HIGH",
        "description": "Apache 2.2.x outdated and vulnerable",
        "reference": "Multiple CVEs"
    },
    {
        "product": "OpenSSH",
        "max_version": "5.0",
        "severity": "MEDIUM",
        "description": "Old OpenSSH version detected",
        "reference": "Legacy version risk"
    }
]


# NOTE: check_exploit_indicators() - helper/entry function. Read the body for the exact steps.
def check_exploit_indicators(product, detected_version):
    if not product or not detected_version:
        return None

    for entry in EXPLOIT_DB:
        if entry["product"].lower() == product.lower():

            # Exact version match
            if "vulnerable_versions" in entry:
                if detected_version in entry["vulnerable_versions"]:
                    return entry

            # Version comparison
            if "max_version" in entry:
                try:
                    if version.parse(detected_version) <= version.parse(entry["max_version"]):
                        return entry
                except:
                    pass

    return None
